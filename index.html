<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Score Dark Mode Mockup</title>
    <style>
        /* --- Dark Mode CSS Styling --- */
        :root {
            --dark-bg: #1a1a1a;
            --main-bg: #282828;
            --card-bg: #333333;
            --text-color: #f0f0f0;
            --primary-color: #007bff;
            --live-color: #38c172;
            --completed-color: #959595;
            --border-color: #444444;
            --hover-color: #3a3a3a;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-color);
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 900px;
            margin: 20px auto;
            background-color: var(--main-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }
        h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 25px;
            text-align: center;
        }

        /* --- Match Card Design --- */
        .league-header { 
            font-size: 1.1em;
            font-weight: bold;
            color: var(--live-color);
            background-color: var(--card-bg);
            padding: 12px;
            border-radius: 4px;
            margin-top: 15px;
            cursor: pointer;
            border: 1px solid var(--border-color);
            transition: background-color 0.2s;
        }
        .league-header:hover { background-color: var(--hover-color); }
        
        /* üö© ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸàŸÇÿ™ ŸàÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ŸÅŸä ÿßŸÑŸÖŸÜÿ™ÿµŸÅ */
        .match-row {
            /* 5 ÿ£ÿπŸÖÿØÿ©: Team A | Score A | Status/Time | Score B | Team B */
            display: grid;
            grid-template-columns: 4fr 1fr 1.5fr 1fr 4fr; 
            align-items: center;
            padding: 10px 0;
            background-color: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 1px;
        }
        .match-row:hover { background-color: var(--hover-color); }
        
        .team-name-display {
            text-align: right; 
            padding-right: 15px;
            font-weight: 500;
        }
        .team-name-away {
            text-align: left; 
            padding-left: 15px;
            font-weight: 500;
        }
        
        /* ÿπŸÜÿßÿµÿ± ÿßŸÑŸÖŸÜÿ™ÿµŸÅ */
        .score-box {
            font-weight: bold;
            text-align: center;
            color: var(--text-color);
            background-color: var(--hover-color);
            padding: 5px 0; 
        }
        .center-status-time {
            font-weight: 600;
            text-align: center;
            font-size: 0.85em;
            border-left: 1px solid var(--border-color);
            border-right: 1px solid var(--border-color);
            padding: 5px 0;
        }
        
        /* Status Indicators */
        .live-status { color: var(--live-color); } 
        .ft-status { color: var(--completed-color); } 
        .ns-status { color: var(--primary-color); } 

        /* --- Modal Styling --- */
        .modal {
            display: none; position: fixed; z-index: 2000; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto;
            background-color: rgba(0, 0, 0, 0.85); 
            padding-top: 50px;
        }
        .modal-content {
            background-color: var(--card-bg); color: var(--text-color);
            margin: 5% auto; padding: 30px; border-radius: 10px;
            width: 90%; max-width: 700px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.9);
        }
        .close {
            color: var(--completed-color); float: right; font-size: 35px;
            font-weight: bold; cursor: pointer; transition: color 0.2s;
        }
        .close:hover { color: var(--text-color); }
        .modal-title {
            color: var(--live-color); text-align: center; margin-bottom: 20px;
            padding-bottom: 10px; border-bottom: 1px solid var(--border-color);
        }
        .loader {
            border: 4px solid var(--border-color); border-top: 4px solid var(--primary-color);
            border-radius: 50%; width: 30px; height: 30px;
            animation: spin 1s linear infinite; margin: 20px auto;
        }
        
        .modal-body table {
            width: 100%; border-collapse: collapse; margin-top: 15px;
            background-color: var(--hover-color); border: 1px solid var(--border-color);
        }
        .modal-body th, .modal-body td {
            padding: 10px 8px; border: 1px solid var(--border-color); text-align: center;
        }
        .modal-body th {
            background-color: var(--hover-color); color: var(--primary-color);
        }
        .modal-body h5 { color: var(--live-color); }
    </style>
</head>
<body>

    <div class="container">
        <h2>‚öΩ Today's Matches</h2>
        <div id="matches-list">
            <p id="loading-message" style="text-align: center;">Loading data...</p>
        </div>
    </div>

    <div id="app-modal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-modal">&times;</span>
            <h3 class="modal-title" id="modal-title"></h3>
            <div id="modal-content-placeholder" class="modal-body">
                </div>
        </div>
    </div>

    <script>
        // --- JavaScript Logic (English) ---

        // üö© Netlify Proxy URLs - Ensure these functions are correctly deployed!
        const PROXY_MATCHES_URL = 'https://mubarayat.netlify.app/.netlify/functions/fetch-matches'; 
        const PROXY_STANDINGS_URL = 'https://mubarayat.netlify.app/.netlify/functions/fetch-standings'; 
        const PROXY_DETAILS_URL = 'https://mubarayat.netlify.app/.netlify/functions/fetch-details'; 
        
        const matchesList = document.getElementById('matches-list');
        const appModal = document.getElementById('app-modal');
        const modalContentPlaceholder = document.getElementById('modal-content-placeholder');
        const modalTitle = document.getElementById('modal-title');
        const closeModalButton = document.getElementById('close-modal');
        const loadingMessage = document.getElementById('loading-message');

        // ---------------------------------
        // Generic Fetching Function (ŸÖŸàÿ∂ÿπŸáÿß ŸÅŸä ÿßŸÑÿ£ÿπŸÑŸâ ŸÑÿ≠ŸÑ ŸÖÿ¥ŸÉŸÑÿ© ReferenceError)
        // ---------------------------------
        async function fetchData(url, errorMsg) {
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`${errorMsg} Status: ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error("Fetch Error:", error);
                return null;
            }
        }
        
        // ---------------------------------
        // Helper Functions (ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑÿ≠ÿßŸÑÿ© ŸàÿßŸÑŸàŸÇÿ™)
        // ---------------------------------

        function getStatusInfo(eps) {
            switch (eps) {
                case 'NS': return { text: 'Time', class: 'ns-status' };
                case 'FT': return { text: 'FT', class: 'ft-status' };
                case 'HT': return { text: 'HT', class: 'live-status' };
                case '1T': return { text: 'LIVE', class: 'live-status' };
                case '2T': return { text: 'LIVE', class: 'live-status' };
                default: return { text: eps, class: 'ns-status' };
            }
        }

        function formatTime(esd) {
            // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑŸÇŸäŸÖÿ© Ÿàÿ∑ŸàŸÑŸáÿß (14 ÿÆÿßŸÜÿ©)
            if (!esd || typeof esd !== 'string' || esd.length < 14) return 'N/A';
            
            // ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑŸàŸÇÿ™ ŸÅŸÇÿ∑ (HH:MM) ŸÖŸÜ ÿßŸÑÿÆÿßŸÜÿßÿ™ 8 ÿ•ŸÑŸâ 12
            const hour = esd.substring(8, 10);
            const minute = esd.substring(10, 12);
            
            return `${hour}:${minute}`; 
        }

        function openModal(title, content) {
            modalTitle.textContent = title;
            modalContentPlaceholder.innerHTML = content;
            appModal.style.display = "block";
        }
        
        // ---------------------------------
        // MODAL/Interaction Functions (ÿßŸÑÿ¢ŸÜ ŸÑÿπÿ±ÿ∂ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸÜÿ≥ŸÇÿ© ŸÖÿ¨ÿØÿØÿßŸã)
        // ---------------------------------
        
        async function fetchStandings(sid, leagueName) {
            openModal(`Loading Standings: ${leagueName}`, '<div class="loader"></div>');

            const data = await fetchData(`${PROXY_STANDINGS_URL}?sid=${sid}`, 'Failed to fetch standings.');

            if (!data) {
                openModal(`Error Fetching Standings`, `<p style="color: red;">Could not fetch standings data. Check Netlify Function (Status: 404/500).</p>`);
                return;
            }
            
            let html = `<h4>${leagueName} Table</h4>`;
            
            if (data.Tables && data.Tables.length > 0 && data.Tables[0].Rows) {
                html += `<table>
                    <thead><tr><th>#</th><th>Team</th><th>Pl</th><th>Pts</th></tr></thead><tbody>`;
                data.Tables[0].Rows.forEach(row => {
                    html += `<tr>
                        <td>${row.Rn || ''}</td>
                        <td style="text-align: left;">${row.Tnm || ''}</td>
                        <td>${row.P || 0}</td>
                        <td><strong>${row.Pts || 0}</strong></td>
                    </tr>`;
                });
                html += '</tbody></table>';
            } else {
                html += `<p style="color: var(--completed-color);">Standings data not available yet.</p>`;
            }

            openModal(`League Standings: ${leagueName}`, html);
        }

        async function fetchMatchDetails(eid, home, away) {
            openModal(`Loading Details: ${home} vs ${away}`, '<div class="loader"></div>');

            const data = await fetchData(`${PROXY_DETAILS_URL}?eid=${eid}`, 'Failed to fetch match details.');

            if (!data) {
                openModal(`Error Fetching Details`, `<p style="color: red;">Could not fetch match details. Check Netlify Function (Status: 404/500).</p>`);
                return;
            }
            
            let html = `<h4>Full Match Details: ${home} vs ${away}</h4><hr>`;
            
            // Events (Goals, Cards)
            html += '<h5>‚ö°Ô∏è Match Events:</h5>';
            if (data.Events && data.Events.length > 0) {
                data.Events.forEach(e => {
                    html += `<p style="margin: 5px 0;">(${e.Min}') ${e.Nm} - ${e.Tnm}</p>`;
                });
            } else {
                html += '<p>No events recorded yet.</p>';
            }

            // Head-to-Head (H2H)
            html += '<hr><h5>‚öîÔ∏è Head-to-Head (Previous Matches):</h5>';
            if (data.H2H && data.H2H.length > 0) {
                data.H2H.forEach(match => {
                    html += `<p style="margin: 5px 0; font-size: 0.9em;">
                        ${formatTime(match.Esd)} | ${match.T1nm} 
                        <span style="font-weight: bold; color: var(--live-color);">${match.Tr1} - ${match.Tr2}</span> 
                        ${match.T2nm}
                    </p>`;
                });
            } else {
                html += '<p>No Head-to-Head data available.</p>';
            }
            
            openModal(`Details: ${home} vs ${away}`, html);
        }
        
        // ---------------------------------
        // Rendering Matches
        // ---------------------------------

        async function renderMatches() {
            const data = await fetchData(PROXY_MATCHES_URL, 'Failed to fetch match list.'); 

            if (loadingMessage) loadingMessage.remove(); 
            
            if (!data || !data.Stages) {
                matchesList.innerHTML = `<p style="color: red; text-align: center;">üî¥ Failed to load initial data. Check Netlify function: ${PROXY_MATCHES_URL}</p>`;
                return;
            }

            matchesList.innerHTML = ''; 

            data.Stages.forEach(stage => {
                const leagueName = stage.Snm || 'Unknown League';
                const countryName = stage.Cnm || 'Unknown Country';
                
                // League Header (Clickable for Standings)
                const leagueHeader = document.createElement('div');
                leagueHeader.className = 'league-header';
                leagueHeader.innerHTML = `üèÜ ${leagueName} - ${countryName}`;
                leagueHeader.dataset.sid = stage.Sid;
                leagueHeader.dataset.action = 'standings';
                leagueHeader.dataset.leaguename = leagueName;
                matchesList.appendChild(leagueHeader);

                if (stage.Events && stage.Events.length > 0) {
                    stage.Events.forEach(event => {
                        const homeTeam = event.T1 ? (event.T1[0].Nm || 'Unknown') : 'Unknown';
                        const awayTeam = event.T2 ? (event.T2[0].Nm || 'Unknown') : 'Unknown';
                        
                        const eventStatus = event.Eps || 'NS'; 
                        const statusInfo = getStatusInfo(eventStatus);
                        
                        const matchTime = formatTime(event.Esd); 
                        
                        // ÿπÿ±ÿ∂ ÿßŸÑŸàŸÇÿ™ ŸÅŸÇÿ∑ ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑÿ≠ÿßŸÑÿ© 'Time' (ÿ£Ÿä 'NS')
                        const displayStatusTime = statusInfo.text === 'Time' ? matchTime : statusInfo.text;
                        
                        const scoreHome = event.Tr1 || 0;
                        const scoreAway = event.Tr2 || 0;
                        
                        const row = document.createElement('div');
                        row.className = 'match-row';
                        
                        row.dataset.action = 'details';
                        row.dataset.eid = event.Eid;
                        row.dataset.home = homeTeam; 
                        row.dataset.away = awayTeam; 
                        
                        row.innerHTML = `
                            <span class="team-name-display">${homeTeam}</span>
                            <span class="score-box">${scoreHome}</span>
                            <span class="center-status-time ${statusInfo.class}">${displayStatusTime}</span>
                            <span class="score-box">${scoreAway}</span>
                            <span class="team-name-away">${awayTeam}</span>
                        `;
                        matchesList.appendChild(row);
                    });
                }
            });

            addInteractionListeners();
        }

        function addInteractionListeners() {
            document.querySelectorAll('[data-action]').forEach(element => {
                element.addEventListener('click', (event) => {
                    const action = event.currentTarget.dataset.action;
                    
                    if (action === 'standings') {
                        const sid = event.currentTarget.dataset.sid;
                        const leagueName = event.currentTarget.dataset.leaguename;
                        fetchStandings(sid, leagueName);
                    } 
                    
                    else if (action === 'details') {
                        const eid = event.currentTarget.dataset.eid;
                        const home = event.currentTarget.dataset.home;
                        const away = event.currentTarget.dataset.away;
                        fetchMatchDetails(eid, home, away);
                    }
                });
            });

            closeModalButton.addEventListener('click', () => appModal.style.display = "none");
            window.addEventListener('click', (event) => {
                if (event.target === appModal) {
                    appModal.style.display = "none";
                }
            });
        }

        renderMatches();
    </script>
</body>
</html>
