<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Score Application</title>
    <style>
        /* --- Dark Mode CSS Styling --- */
        :root {
            --dark-bg: #1a1a1a;
            --main-bg: #282828;
            --card-bg: #333333;
            --text-color: #f0f0f0;
            --primary-color: #007bff;
            --live-color: #38c172;
            --completed-color: #959595;
            --border-color: #444444;
            --hover-color: #3a3a3a;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-color);
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 900px;
            margin: 20px auto;
            background-color: var(--main-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }
        h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 25px;
            text-align: center;
        }

        /* --- Match Card Design --- */
        .league-header { 
            font-size: 1.1em;
            font-weight: bold;
            color: var(--live-color);
            background-color: var(--card-bg);
            padding: 12px;
            border-radius: 4px;
            margin-top: 15px;
            cursor: pointer;
            border: 1px solid var(--border-color);
            transition: background-color 0.2s;
        }
        .league-header:hover { background-color: var(--hover-color); }
        
        /* üö© ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸàŸÇÿ™ ŸàÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ŸÅŸä ÿßŸÑŸÖŸÜÿ™ÿµŸÅ */
        .match-row {
            display: grid;
            grid-template-columns: 4fr 1fr 1.5fr 1fr 4fr; 
            align-items: center;
            padding: 10px 0;
            background-color: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 1px;
        }
        .match-row:hover { background-color: var(--hover-color); }
        
        .team-name-display {
            text-align: right; 
            padding-right: 15px;
            font-weight: 500;
        }
        .team-name-away {
            text-align: left; 
            padding-left: 15px;
            font-weight: 500;
        }
        
        /* ÿπŸÜÿßÿµÿ± ÿßŸÑŸÖŸÜÿ™ÿµŸÅ */
        .score-box {
            font-weight: bold;
            text-align: center;
            color: var(--text-color);
            background-color: var(--hover-color);
            padding: 5px 0; 
        }
        .center-status-time {
            font-weight: 600;
            text-align: center;
            font-size: 0.85em;
            border-left: 1px solid var(--border-color);
            border-right: 1px solid var(--border-color);
            padding: 5px 0;
        }
        
        /* Status Indicators */
        .live-status { color: var(--live-color); } 
        .ft-status { color: var(--completed-color); } 
        .ns-status { color: var(--primary-color); } 

        /* --- Modal Styling --- */
        .modal {
            display: none; position: fixed; z-index: 2000; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto;
            background-color: rgba(0, 0, 0, 0.85); 
            padding-top: 50px;
        }
        .modal-content {
            background-color: var(--card-bg); color: var(--text-color);
            margin: 5% auto; padding: 30px; border-radius: 10px;
            width: 90%; max-width: 700px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.9);
        }
        .close {
            color: var(--completed-color); float: right; font-size: 35px;
            font-weight: bold; cursor: pointer; transition: color 0.2s;
        }
        .close:hover { color: var(--text-color); }
        .modal-title {
            color: var(--live-color); text-align: center; margin-bottom: 20px;
            padding-bottom: 10px; border-bottom: 1px solid var(--border-color);
        }
        .loader {
            border: 4px solid var(--border-color); border-top: 4px solid var(--primary-color);
            border-radius: 50%; width: 30px; height: 30px;
            animation: spin 1s linear infinite; margin: 20px auto;
        }
        
        .modal-body table {
            width: 100%; border-collapse: collapse; margin-top: 15px;
            background-color: var(--hover-color); border: 1px solid var(--border-color);
        }
        .modal-body th, .modal-body td {
            padding: 10px 8px; border: 1px solid var(--border-color); text-align: center;
        }
        .modal-body th {
            background-color: var(--hover-color); color: var(--primary-color);
        }
        .modal-body h5 { color: var(--live-color); }

        /* Style for Team Logos */
        .team-name-display img, .team-name-away img {
            height: 20px; 
            vertical-align: middle; 
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>‚öΩ Today's Matches</h2>
        <div id="matches-list">
            <p id="loading-message" style="text-align: center;">Loading data...</p>
        </div>
    </div>

    <div id="app-modal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-modal">&times;</span>
            <h3 class="modal-title" id="modal-title"></h3>
            <div id="modal-content-placeholder" class="modal-body">
                </div>
        </div>
    </div>

    <script>
        // --- JavaScript Logic ---

        // üö© ÿßŸÑÿ±Ÿàÿßÿ®ÿ∑ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©
        const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
        const LOGO_BASE_URL = 'https://assets.livescore.com/soccer/badge/100x100/';

        // üö© ÿ±Ÿàÿßÿ®ÿ∑ LiveScore API (ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸäŸàŸÖ ŸáŸà 20251201)
        const LIVE_SCORE_MATCHES_URL = 'https://prod-public-api.livescore.com/v1/api/app/date/soccer/20251201/0';
        const LIVE_SCORE_STANDINGS_URL = 'https://prod-public-api.livescore.com/v1/api/app/division/soccer/{sid}/0'; 
        const LIVE_SCORE_DETAILS_URL = 'https://prod-public-api.livescore.com/v1/api/app/match/{eid}/0/1/en'; 
        
        const matchesList = document.getElementById('matches-list');
        const appModal = document.getElementById('app-modal');
        const modalContentPlaceholder = document.getElementById('modal-content-placeholder');
        const modalTitle = document.getElementById('modal-title');
        const closeModalButton = document.getElementById('close-modal');
        const loadingMessage = document.getElementById('loading-message');

        // ---------------------------------
        // Generic Fetching Function
        // ---------------------------------
        async function fetchData(externalUrl, errorMsg) {
            // ÿØŸÖÿ¨ ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿ®ÿ±ŸàŸÉÿ≥Ÿä ŸÖÿπ ÿ±ÿßÿ®ÿ∑ ÿßŸÑŸÄ API
            const proxyUrl = CORS_PROXY + encodeURIComponent(externalUrl);
            
            try {
                const response = await fetch(proxyUrl);
                if (!response.ok) throw new Error(`${errorMsg} Status: ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error("Fetch Error:", error);
                openModal("Connection Error", `<p style="color: red;">Failed to fetch data: ${errorMsg}. Please check the API link or the CORS Proxy service.</p>`);
                return null;
            }
        }
        
        // ---------------------------------
        // Helper Functions 
        // ---------------------------------

        function getStatusInfo(eps) {
            switch (eps) {
                case 'NS': return { text: 'Time', class: 'ns-status' };
                case 'FT': return { text: 'FT', class: 'ft-status' };
                case 'HT': return { text: 'HT', class: 'live-status' };
                case '1T': return { text: 'LIVE', class: 'live-status' };
                case '2T': return { text: 'LIVE', class: 'live-status' };
                default: return { text: eps, class: 'ns-status' };
            }
        }

        // üö© ÿßŸÑÿØÿßŸÑÿ© ÿßŸÑŸÖÿµÿ≠ÿ≠ÿ© ŸÑÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿ™ŸàŸÇŸäÿ™ ÿ•ŸÑŸâ ÿßŸÑÿ™ŸàŸÇŸäÿ™ ÿßŸÑŸÖÿ≠ŸÑŸä (ŸÖÿπ Fallback)
        function formatTime(esd) {
            if (!esd || typeof esd !== 'string' || esd.length < 14) {
                return 'N/A';
            }

            // ŸÅŸÉ ÿ¥ŸäŸÅÿ±ÿ© ÿßŸÑÿ™ÿßÿ±ŸäÿÆ (YYYYMMDDHHMMSS)
            const year = esd.substring(0, 4);
            const month = esd.substring(4, 6);
            const day = esd.substring(6, 8);
            const hour = esd.substring(8, 10);
            const minute = esd.substring(10, 12);

            try {
                const jsMonth = month - 1; 
                
                // ÿ®ŸÜÿßÿ° ŸÉÿßÿ¶ŸÜ Date ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿØÿßŸÑÿ© UTC
                const date = new Date(Date.UTC(year, jsMonth, day, hour, minute));
                
                if (isNaN(date.getTime())) {
                    throw new Error('Invalid Date Parsing');
                }

                // ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸàŸÇŸäÿ™ ÿ®ÿßŸÑÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑŸÖÿ≠ŸÑŸä (ÿßŸÑÿ≥ÿßÿπÿ© ŸàÿßŸÑÿØŸÇÿßÿ¶ŸÇ) ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
                return date.toLocaleTimeString('en-US', { 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    hour12: false 
                });
                
            } catch (e) {
                // ÿßŸÑÿπÿ±ÿ∂ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿä: ÿπÿ±ÿ∂ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ŸàÿßŸÑŸàŸÇÿ™ ÿßŸÑÿÆÿßŸÖ (ÿ∫Ÿäÿ± ŸÖÿ≠ŸàŸÑ)
                return `${day}/${month} ${hour}:${minute}`; 
            }
        }

        function openModal(title, content) {
            modalTitle.textContent = title;
            modalContentPlaceholder.innerHTML = content;
            appModal.style.display = "block";
        }
        
        // ---------------------------------
        // MODAL/Interaction Functions
        // ---------------------------------
        
        async function fetchStandings(sid, leagueName) {
            openModal(`Loading Standings: ${leagueName}`, '<div class="loader"></div>');
            
            const url = LIVE_SCORE_STANDINGS_URL.replace('{sid}', sid);

            const data = await fetchData(url, 'Failed to fetch standings.');

            if (!data) return;
            
            let html = `<h4>${leagueName} Table</h4>`;
            
            if (data.Tables && data.Tables.length > 0 && data.Tables[0].Rows) {
                html += `<table>
                    <thead><tr><th>#</th><th>Team</th><th>Pl</th><th>Pts</th></tr></thead><tbody>`;
                data.Tables[0].Rows.forEach(row => {
                    html += `<tr>
                        <td>${row.Rn || ''}</td>
                        <td style="text-align: left;">${row.Tnm || ''}</td>
                        <td>${row.P || 0}</td>
                        <td><strong>${row.Pts || 0}</strong></td>
                    </tr>`;
                });
                html += '</tbody></table>';
            } else {
                html += `<p style="color: var(--completed-color);">Standings data not available yet.</p>`;
            }

            openModal(`League Standings: ${leagueName}`, html);
        }

        async function fetchMatchDetails(eid, home, away) {
            openModal(`Loading Details: ${home} vs ${away}`, '<div class="loader"></div>');
            
            const url = LIVE_SCORE_DETAILS_URL.replace('{eid}', eid);

            const data = await fetchData(url, 'Failed to fetch match details.');

            if (!data) return;
            
            let html = `<h4>Full Match Details: ${home} vs ${away}</h4><hr>`;
            
            // Events (Goals, Cards)
            html += '<h5>‚ö°Ô∏è Match Events:</h5>';
            if (data.Events && data.Events.length > 0) {
                data.Events.forEach(e => {
                    html += `<p style="margin: 5px 0;">(${e.Min}') ${e.Nm} - ${e.Tnm}</p>`;
                });
            } else {
                html += '<p>No events recorded yet.</p>';
            }

            // Head-to-Head (H2H)
            html += '<hr><h5>‚öîÔ∏è Head-to-Head (Previous Matches):</h5>';
            if (data.H2H && data.H2H.length > 0) {
                data.H2H.forEach(match => {
                    const formattedTime = formatTime(match.Esd || ''); 
                    html += `<p style="margin: 5px 0; font-size: 0.9em;">
                        ${formattedTime} | ${match.T1nm} 
                        <span style="font-weight: bold; color: var(--live-color);">${match.Tr1} - ${match.Tr2}</span> 
                        ${match.T2nm}
                    </p>`;
                });
            } else {
                html += '<p>No Head-to-Head data available.</p>';
            }
            
            openModal(`Details: ${home} vs ${away}`, html);
        }
        
        // ---------------------------------
        // Rendering Matches
        // ---------------------------------

        async function renderMatches() {
            const data = await fetchData(LIVE_SCORE_MATCHES_URL, 'Failed to fetch match list.'); 

            if (loadingMessage) loadingMessage.remove(); 
            
            if (!data || !data.Stages) {
                matchesList.innerHTML = `<p style="color: red; text-align: center;">üî¥ Failed to load data. Check API URL or Proxy.</p>`;
                return;
            }

            matchesList.innerHTML = ''; 

            data.Stages.forEach(stage => {
                const leagueName = stage.Snm || 'Unknown League';
                const countryName = stage.Cnm || 'Unknown Country';
                
                // League Header (Clickable for Standings)
                const leagueHeader = document.createElement('div');
                leagueHeader.className = 'league-header';
                leagueHeader.innerHTML = `üèÜ ${leagueName} - ${countryName}`;
                leagueHeader.dataset.sid = stage.Sid;
                leagueHeader.dataset.action = 'standings';
                leagueHeader.dataset.leaguename = leagueName;
                matchesList.appendChild(leagueHeader);

                if (stage.Events && stage.Events.length > 0) {
                    stage.Events.forEach(event => {
                        const homeTeam = event.T1 ? (event.T1[0].Nm || 'Unknown') : 'Unknown';
                        const awayTeam = event.T2 ? (event.T2[0].Nm || 'Unknown') : 'Unknown';
                        
                        // Logos
                        const homeLogo = event.T1 ? (event.T1[0].Img || '') : '';
                        const awayLogo = event.T2 ? (event.T2[0].Img || '') : '';

                        const eventStatus = event.Eps || 'NS'; 
                        const statusInfo = getStatusInfo(eventStatus);
                        
                        const matchTime = formatTime(event.Esd || ''); 
                        
                        const displayStatusTime = statusInfo.text === 'Time' ? matchTime : statusInfo.text;
                        
                        const scoreHome = event.Tr1 || 0;
                        const scoreAway = event.Tr2 || 0;
                        
                        const row = document.createElement('div');
                        row.className = 'match-row';
                        
                        row.dataset.action = 'details';
                        row.dataset.eid = event.Eid;
                        row.dataset.home = homeTeam; 
                        row.dataset.away = awayTeam; 
                        
                        row.innerHTML = `
                            <span class="team-name-display">
                                ${homeTeam} 
                                ${homeLogo ? `<img src="${LOGO_BASE_URL}${homeLogo}" alt="${homeTeam}" style="margin-left: 5px;">` : ''}
                            </span>
                            <span class="score-box">${scoreHome}</span>
                            <span class="center-status-time ${statusInfo.class}">${displayStatusTime}</span>
                            <span class="score-box">${scoreAway}</span>
                            <span class="team-name-away">
                                ${awayLogo ? `<img src="${LOGO_BASE_URL}${awayLogo}" alt="${awayTeam}" style="margin-right: 5px;">` : ''}
                                ${awayTeam}
                            </span>
                        `;
                        matchesList.appendChild(row);
                    });
                }
            });

            addInteractionListeners();
        }

        function addInteractionListeners() {
            document.querySelectorAll('[data-action]').forEach(element => {
                element.addEventListener('click', (event) => {
                    const action = event.currentTarget.dataset.action;
                    
                    if (action === 'standings') {
                        const sid = event.currentTarget.dataset.sid;
                        const leagueName = event.currentTarget.dataset.leaguename;
                        fetchStandings(sid, leagueName);
                    } 
                    
                    else if (action === 'details') {
                        const eid = event.currentTarget.dataset.eid;
                        const home = event.currentTarget.dataset.home;
                        const away = event.currentTarget.dataset.away;
                        fetchMatchDetails(eid, home, away);
                    }
                });
            });

            closeModalButton.addEventListener('click', () => appModal.style.display = "none");
            window.addEventListener('click', (event) => {
                if (event.target === appModal) {
                    appModal.style.display = "none";
                }
            });
        }

        renderMatches();
    </script>
</body>
</html>
