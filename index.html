<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Score Mockup | Ù…Ø­Ø§ÙƒØ§Ø© ØªØµÙ…ÙŠÙ… LiveScore</title>
    <style>
        /* --- CSS Styling: ØªØµÙ…ÙŠÙ… LiveScore Ø§Ù„Ù…Ø­Ø§ÙƒÙŠ --- */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #e6e9f0; /* Ø®Ù„ÙÙŠØ© ÙØ§ØªØ­Ø© */
            color: #1a1a1a;
            margin: 0;
            padding: 0;
            direction: rtl; /* Ø§ØªØ¬Ø§Ù‡ Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ù„Ù„ÙŠØ³Ø§Ø± */
        }
        .main-wrapper {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 2fr 1fr; /* Ø¹Ù…ÙˆØ¯ Ù„Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª ÙˆØ¹Ù…ÙˆØ¯ Ù„Ù„ØªÙØ§ØµÙŠÙ„ */
            gap: 20px;
            padding: 20px 10px;
        }
        .matches-container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            min-height: 80vh;
            order: 1; /* Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª ÙÙŠ Ø§Ù„ÙŠÙ…ÙŠÙ† (Ù„Ø£Ù†Ù†Ø§ RTL) */
        }
        .details-sidebar {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            order: 2; /* Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙÙŠ Ø§Ù„ÙŠØ³Ø§Ø± (Ù„Ø£Ù†Ù†Ø§ RTL) */
            position: sticky;
            top: 20px;
            min-height: 500px;
        }

        /* --- Ù…Ø¨Ø§Ø±ÙŠØ§Øª (Match Card) --- */
        .league-header { 
            font-size: 1.1em;
            font-weight: bold;
            color: #007bff;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            margin-top: 15px;
            cursor: pointer;
        }
        .match-row {
            display: grid;
            grid-template-columns: 1fr 4fr 1fr 4fr 1fr; /* Ø§Ù„ÙˆÙ‚Øª/Ø§Ù„Ø­Ø§Ù„Ø© | ÙØ±ÙŠÙ‚ | Ù†ØªÙŠØ¬Ø© | ÙØ±ÙŠÙ‚ | ØªÙØ§ØµÙŠÙ„ */
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 0.95em;
        }
        .match-row:hover {
            background-color: #f7f7f7;
        }
        .match-status {
            font-weight: 600;
            color: #dc3545; /* Ù„ÙˆÙ† Ø£Ø­Ù…Ø± Ø§ÙØªØ±Ø§Ø¶ÙŠ */
            text-align: center;
        }
        .live-status { color: #28a745; } /* Ù„ÙˆÙ† Ø£Ø®Ø¶Ø± Ù„Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„Ø¬Ø§Ø±ÙŠØ© */
        .ft-status { color: #6c757d; } /* Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ Ù„Ù„Ù…ÙƒØªÙ…Ù„Ø© */
        .ns-status { color: #17a2b8; } /* Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚ Ù„Ù€ Ù„Ù… ØªØ¨Ø¯Ø£ */

        .team-name-display {
            text-align: right;
            padding-right: 15px;
            font-weight: 500;
        }
        .score-box {
            font-weight: bold;
            text-align: center;
            color: #1a1a1a;
        }
        .details-link {
            text-align: center;
            color: #007bff;
            font-size: 1.2em;
        }
        .details-link:hover {
            text-decoration: underline;
        }
        
        /* --- Modal Styling --- */
        .modal { /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ù„Ù„ØªØ±ØªÙŠØ¨ */
            display: none; position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto;
            background-color: rgba(0, 0, 0, 0.8); 
            padding-top: 50px;
        }
        .modal-content {
            background-color: #fff; margin: 5% auto; padding: 30px;
            border-radius: 10px; width: 90%; max-width: 900px;
        }
        .loader {
            border: 4px solid #f3f3f3; border-top: 4px solid #007bff;
            border-radius: 50%; width: 30px; height: 30px;
            animation: spin 1s linear infinite; margin: 20px auto;
        }
    </style>
</head>
<body>

    <div class="main-wrapper">
        <div class="matches-container">
            <h3 style="color: #1a1a1a; border-bottom: 2px solid #eee; padding-bottom: 10px;">ğŸ—“ï¸ Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
            <div id="matches-list">
                <p id="loading-message">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
            </div>
        </div>

        <div class="details-sidebar">
            <h3 style="color: #007bff; border-bottom: 2px solid #eee; padding-bottom: 10px;">ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©/Ø§Ù„Ø­Ø¯Ø«</h3>
            <div id="details-content">
                <p style="color: #888;">Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ù…Ø¨Ø§Ø±Ø§Ø© Ù„Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„Ù‡Ø§ Ù‡Ù†Ø§ (Ø§Ù„Ø£Ø­Ø¯Ø§Ø«ØŒ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©ØŒ Ø¥Ù„Ø®).</p>
            </div>
        </div>
    </div>

    <div id="standings-modal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-modal" style="float: left; font-size: 30px; cursor: pointer;">&times;</span>
            <h3 class="modal-title" style="text-align: center;" id="modal-title"></h3>
            <div id="modal-content-placeholder" class="modal-body">
                </div>
        </div>
    </div>

    <script>
        // --- JavaScript Logic ---

        // ğŸš© Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„ÙˆÙƒÙŠÙ„ (ÙŠØ¬Ø¨ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„Ù‡Ø§)
        const PROXY_MATCHES_URL = 'https://mubarayat.netlify.app/.netlify/functions/fetch-matches'; 
        const PROXY_STANDINGS_URL = 'https://mubarayat.netlify.app/.netlify/functions/fetch-standings'; 
        const PROXY_DETAILS_URL = 'https://mubarayat.netlify.app/.netlify/functions/fetch-details'; 
        
        const matchesList = document.getElementById('matches-list');
        const detailsContent = document.getElementById('details-content');
        const standingsModal = document.getElementById('standings-modal');
        const modalContentPlaceholder = document.getElementById('modal-content-placeholder');
        const modalTitle = document.getElementById('modal-title');
        const closeModalButton = document.getElementById('close-modal');
        const loadingMessage = document.getElementById('loading-message');

        // ---------------------------------
        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¬Ù„Ø¨ (Fetching Functions)
        // ---------------------------------

        async function fetchData(url, errorMsg) {
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`${errorMsg} Status: ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error("Fetch Error:", error);
                return null;
            }
        }
        
        async function fetchMatchesData() {
            return fetchData(PROXY_MATCHES_URL, 'ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª.');
        }

        async function fetchStandings(sid, leagueName) {
            modalTitle.textContent = `Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ØªØ±ØªÙŠØ¨ ${leagueName}...`;
            modalContentPlaceholder.innerHTML = '<div class="loader"></div>';
            standingsModal.style.display = "block";

            const data = await fetchData(`${PROXY_STANDINGS_URL}?sid=${sid}`, 'ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªØ±ØªÙŠØ¨.');

            if (!data) {
                modalTitle.textContent = `Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ ØªØ±ØªÙŠØ¨ ${leagueName}`;
                modalContentPlaceholder.innerHTML = `<p style="color: red;">ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ±ØªÙŠØ¨. ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¸ÙŠÙØ© Netlify (fetch-standings).</p>`;
                return;
            }
            
            // Ø¨Ù†Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ±ØªÙŠØ¨ (ÙŠÙØªØ±Ø¶ Ù‡ÙŠÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§Øª API Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠ)
            let html = `<h4>${leagueName}</h4>`;
            if (data.Tables && data.Tables.length > 0 && data.Tables[0].Rows) {
                html += `<table>
                    <thead><tr><th>#</th><th>Ø§Ù„ÙØ±ÙŠÙ‚</th><th>Ù„Ø¹Ø¨</th><th>Ù†Ù‚Ø§Ø·</th></tr></thead><tbody>`;
                data.Tables[0].Rows.forEach(row => {
                    html += `<tr>
                        <td>${row.Rn || ''}</td>
                        <td style="text-align: right;">${row.Tnm || ''}</td>
                        <td>${row.P || 0}</td>
                        <td><strong>${row.Pts || 0}</strong></td>
                    </tr>`;
                });
                html += '</tbody></table>';
            } else {
                html += `<p style="color: #888;">Ù„Ø§ ØªØªÙˆÙØ± Ø¨ÙŠØ§Ù†Ø§Øª ØªØ±ØªÙŠØ¨ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø­Ø§Ù„ÙŠØ§Ù‹.</p>`;
            }

            modalTitle.textContent = `ğŸ¥‡ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¯ÙˆØ±ÙŠ: ${leagueName}`;
            modalContentPlaceholder.innerHTML = html;
        }

        async function fetchMatchDetails(eid, home, away) {
            detailsContent.innerHTML = '<div class="loader"></div><p style="text-align:center;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„...</p>';

            const data = await fetchData(`${PROXY_DETAILS_URL}?eid=${eid}`, 'ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªÙØ§ØµÙŠÙ„.');

            if (!data) {
                detailsContent.innerHTML = `<p style="color: red;">ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©. ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¸ÙŠÙØ© Netlify (fetch-details).</p>`;
                return;
            }
            
            // 2. Ø¨Ù†Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ (Side Panel)
            let html = `
                <h4>âš½ï¸ ${home} vs ${away}</h4>
                <p><strong>Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© (EID):</strong> ${eid}</p><hr>
            `;
            
            // Ø§Ù„Ø£Ø­Ø¯Ø§Ø« (Goals, Cards)
            html += '<h5>âš¡ï¸ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©:</h5>';
            if (data.Events && data.Events.length > 0) {
                data.Events.forEach(e => {
                    html += `<p style="margin: 5px 0;">(${e.Min}') ${e.Nm} - ${e.Tnm}</p>`;
                });
            } else {
                html += '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø­Ø¯Ø§Ø« Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯.</p>';
            }

            // Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© (H2H)
            html += '<hr><h5>âš”ï¸ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©:</h5>';
            if (data.H2H && data.H2H.length > 0) {
                data.H2H.forEach(match => {
                    html += `<p style="margin: 5px 0; font-size: 0.9em;">
                        ${formatTime(match.Esd).split(' ')[0]} | ${match.T1nm} 
                        <span style="font-weight: bold;">${match.Tr1} - ${match.Tr2}</span> 
                        ${match.T2nm}
                    </p>`;
                });
            } else {
                html += '<p>Ù„Ø§ ØªØªÙˆÙØ± Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©.</p>';
            }
            
            detailsContent.innerHTML = html;
        }

        // ---------------------------------
        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„ØªÙ†Ø³ÙŠÙ‚
        // ---------------------------------
        
        function getStatusInfo(eps) {
            switch (eps) {
                case 'NS': return { text: 'Ù„Ù… ØªØ¨Ø¯Ø£', class: 'ns-status' };
                case 'FT': return { text: 'Ù…ÙƒØªÙ…Ù„Ø©', class: 'ft-status' };
                case 'HT': return { text: 'Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´ÙˆØ· 1', class: 'ft-status' };
                case '1T': return { text: 'Ø¬Ø§Ø±ÙŠØ©', class: 'live-status' };
                case '2T': return { text: 'Ø¬Ø§Ø±ÙŠØ©', class: 'live-status' };
                default: return { text: eps, class: 'ns-status' };
            }
        }

        function formatTime(esd) {
            if (!esd || esd.length !== 14) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const year = esd.substring(0, 4);
            const month = esd.substring(4, 6);
            const day = esd.substring(6, 8);
            const hour = esd.substring(8, 10);
            const minute = esd.substring(10, 12);
            return `${day}/${month}/${year} ${hour}:${minute}`;
        }
        
        async function renderMatches() {
            const data = await fetchMatchesData();

            if (loadingMessage) loadingMessage.remove(); 
            
            if (!data || !data.Stages) {
                matchesList.innerHTML = `<p style="color: red; padding: 10px;">ğŸ”´ ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† ${PROXY_MATCHES_URL}</p>`;
                return;
            }

            matchesList.innerHTML = ''; 

            data.Stages.forEach(stage => {
                const leagueName = stage.Snm;
                const countryName = stage.Cnm;
                
                // Ø±Ø£Ø³ Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù†Ù‚Ø± Ù„Ø¬Ù„Ø¨ Ø§Ù„ØªØ±ØªÙŠØ¨
                const leagueHeader = document.createElement('div');
                leagueHeader.className = 'league-header';
                leagueHeader.innerHTML = `ğŸ† ${leagueName} - ${countryName} <span style="font-size: 0.8em; color: #007bff; float: left;">(Ø¹Ø±Ø¶ Ø§Ù„ØªØ±ØªÙŠØ¨)</span>`;
                leagueHeader.dataset.sid = stage.Sid;
                leagueHeader.dataset.action = 'standings';
                leagueHeader.dataset.leaguename = leagueName;

                matchesList.appendChild(leagueHeader);

                if (stage.Events && stage.Events.length > 0) {
                    stage.Events.forEach(event => {
                        const homeTeam = event.T1[0];
                        const awayTeam = event.T2[0];
                        
                        const statusInfo = getStatusInfo(event.Eps);
                        const matchTime = formatTime(event.Esd).split(' ')[1]; 
                        
                        const scoreHome = event.Tr1 || 0;
                        const scoreAway = event.Tr2 || 0;
                        
                        const row = document.createElement('div');
                        row.className = 'match-row';
                        row.dataset.action = 'details';
                        row.dataset.eid = event.Eid;
                        row.dataset.home = homeTeam.Nm;
                        row.dataset.away = awayTeam.Nm;
                        
                        row.innerHTML = `
                            <span class="match-status ${statusInfo.class}">
                                ${statusInfo.text === 'Ù„Ù… ØªØ¨Ø¯Ø£' ? matchTime : statusInfo.text}
                            </span>
                            <span class="team-name-display">${homeTeam.Nm}</span>
                            <span class="score-box">${scoreHome}</span>
                            <span class="team-name-display" style="text-align: left; padding-left: 15px; padding-right: 0;">${awayTeam.Nm}</span>
                            <span class="score-box">${scoreAway}</span>
                        `;
                        matchesList.appendChild(row);
                    });
                }
            });

            addInteractionListeners();
        }

        function addInteractionListeners() {
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø±Ø¤ÙˆØ³ Ø§Ù„Ø¯ÙˆØ±ÙŠØ§Øª (Ù„Ø¬Ù„Ø¨ Ø§Ù„ØªØ±ØªÙŠØ¨ ÙÙŠ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„)
            document.querySelectorAll('[data-action="standings"]').forEach(element => {
                element.addEventListener('click', (event) => {
                    event.stopPropagation();
                    const sid = event.currentTarget.dataset.sid;
                    const leagueName = event.currentTarget.dataset.leaguename;
                    fetchStandings(sid, leagueName);
                });
            });

            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ ØµÙÙˆÙ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª (Ù„Ø¬Ù„Ø¨ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙÙŠ Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ)
            document.querySelectorAll('.match-row').forEach(element => {
                element.addEventListener('click', (event) => {
                    const eid = event.currentTarget.dataset.eid;
                    const home = event.currentTarget.dataset.home;
                    const away = event.currentTarget.dataset.away;
                    
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                    document.querySelectorAll('.match-row').forEach(row => row.style.backgroundColor = 'transparent');
                    event.currentTarget.style.backgroundColor = '#e9f7fe';
                    
                    fetchMatchDetails(eid, home, away);
                });
            });

            closeModalButton.addEventListener('click', () => standingsModal.style.display = "none");
            window.addEventListener('click', (event) => {
                if (event.target === standingsModal) {
                    standingsModal.style.display = "none";
                }
            });
        }

        renderMatches();
    </script>
</body>
</html>
