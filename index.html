<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¹Ø±Ø¶ Ù…Ø¨Ø§Ø±ÙŠØ§Øª - ÙƒÙ„ Ø´ÙŠØ¡ ÙÙŠ Ù…ÙˆØ¯Ø§Ù„</title>
    <style>
        /* --- CSS Styling --- */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 20px;
            text-align: right; 
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h2 {
            color: #007bff;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        /* ØªØµÙ…ÙŠÙ… Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .league-title-header { 
            color: #007bff;
            background-color: #f0f0f0;
            padding: 10px;
            margin-top: 20px;
            border-radius: 5px;
            font-size: 1.3em;
        }
        .match-card {
            background-color: #e9ecef;
            border-radius: 8px;
            margin-bottom: 15px;
            padding: 15px;
            transition: background-color 0.3s;
            border-right: 5px solid #28a745; /* Ù„ÙˆÙ† Ù…Ø®ØªÙ„Ù Ù„Ù„Ù…Ø¨Ø§Ø±Ø§Ø© */
        }
        .match-card:hover {
            background-color: #dcdfe3;
        }
        .match-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .league-name, .team-name {
            font-weight: bold;
            color: #28a745;
            cursor: pointer;
            text-decoration: underline;
            flex-grow: 1;
            padding: 0 10px;
            text-align: center;
        }
        .league-name {
             color: #007bff; /* Ù„ÙˆÙ† Ù…Ø®ØªÙ„Ù Ù„Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±ÙŠ ÙÙŠ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
             flex-basis: 25%;
        }
        .time-status {
            font-weight: bold;
            color: #dc3545;
            margin: 0 15px;
            flex-basis: 10%;
        }

        /* --- Full Screen Modal (Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©) --- */
        .modal {
            display: none; 
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.9); 
            padding-top: 50px;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto; 
            padding: 40px;
            border-radius: 10px;
            width: 80%;
            max-width: 800px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.5s;
        }
        .close {
            color: #aaa;
            float: left;
            font-size: 35px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }
        .close:hover {
            color: #000;
        }
        .modal-body h4 {
            color: #007bff;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h2 id="main-title">ØªØ­Ù…ÙŠÙ„ Ù…Ø¨Ø§Ø±ÙŠØ§Øª: 2025/12/01</h2>
        <div id="matches-list">
            <p id="loading-message">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
        </div>
    </div>

    <div id="match-modal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-modal">&times;</span>
            <div id="modal-content-placeholder" class="modal-body">
                </div>
        </div>
    </div>

    <script>
        // --- JavaScript Logic ---

        // ğŸš© Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„ØµØ­ÙŠØ­ Ù„Ù„Ø®Ø§Ø¯Ù… Ø§Ù„ÙˆÙƒÙŠÙ„ Ø¹Ù„Ù‰ Netlify (ÙŠØ¬Ø¨ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡ ÙŠØ¹Ù…Ù„)
        const PROXY_FUNCTION_URL = 'https://mubarayat.netlify.app/.netlify/functions/fetch-matches';
        
        const matchesList = document.getElementById('matches-list');
        const matchModal = document.getElementById('match-modal');
        const modalContentPlaceholder = document.getElementById('modal-content-placeholder');
        const closeModalButton = document.getElementById('close-modal');
        const loadingMessage = document.getElementById('loading-message');


        /**
         * 1. Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„ÙˆÙƒÙŠÙ„
         */
        async function fetchMatchesData() {
            try {
                const response = await fetch(PROXY_FUNCTION_URL);
                
                if (!response.ok) {
                    throw new Error(`Proxy error! status: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error("Fetch Error:", error);
                return null;
            }
        }

        /**
         * 2. ØªØ­Ù„ÙŠÙ„ ÙˆØ¨Ù†Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
         */
        async function renderMatches() {
            const data = await fetchMatchesData();

            if (loadingMessage) {
                loadingMessage.remove(); 
            }
            
            if (!data || !data.Stages) {
                matchesList.innerHTML = `<p style="color: red; padding: 10px;">ğŸ”´ **ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©.** ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Netlify Proxy Function ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø³Ù„ÙŠÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø·: <code>${PROXY_FUNCTION_URL}</code></p>`;
                return;
            }

            matchesList.innerHTML = ''; 

            data.Stages.forEach(stage => {
                const leagueName = stage.Snm;
                const countryName = stage.Cnm;
                
                // ØªØ¬Ù…ÙŠØ¹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±ÙŠ Ù„Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ø³Ù…Ù‡
                const leagueDetails = `
                    <h3>ğŸ† ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±ÙŠ: ${leagueName}</h3>
                    <p><strong>Ø§Ù„Ø¨Ù„Ø¯:</strong> ${countryName}</p>
                    <p><strong>Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù†Ø¸Ø§Ù… (SID):</strong> ${stage.Sid}</p>
                    <p><strong>Ù„ÙˆÙ† Ø§Ù„ØªÙ…ÙŠÙŠØ²:</strong> ${stage.firstColor || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</p>
                    <p><strong>Ø±Ø§Ø¨Ø· Ø§Ù„Ø´Ø¹Ø§Ø±:</strong> ${stage.badgeUrl || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}</p>
                    <hr>
                    <h4>Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙˆØ±ÙŠ:</h4>
                `;


                // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø³Ù… Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯ÙˆØ±ÙŠ
                const leagueHeader = document.createElement('h3');
                leagueHeader.className = 'league-title-header'; 
                leagueHeader.innerHTML = `ğŸ† ${leagueName} - ${countryName}`;
                matchesList.appendChild(leagueHeader);

                // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¯ÙˆØ±ÙŠ
                if (stage.Events && stage.Events.length > 0) {
                    stage.Events.forEach(event => {
                        const homeTeam = event.T1[0];
                        const awayTeam = event.T2[0];
                        
                        const statusText = getStatusText(event.Eps);
                        const startTime = formatTime(event.Esd);
                        
                        // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø§Ù„ØªÙŠ Ø³ØªØ¹Ø±Ø¶ ÙÙŠ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙØ±ÙŠÙ‚
                        const matchDetailsForModal = `
                            <h3>âš½ï¸ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©: ${homeTeam.Nm} vs ${awayTeam.Nm}</h3>
                            <p><strong>Ø§Ù„Ø¯ÙˆØ±ÙŠ:</strong> ${leagueName} (${countryName})</p>
                            <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${statusText}</p>
                            <p><strong>ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø¡:</strong> ${startTime}</p>
                            <hr>
                            <p><strong>Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© (EID):</strong> ${event.Eid}</p>
                            ${event.Media ? `<h4>ğŸ“º Ø§Ù„Ø¨Ø« Ø§Ù„Ù…ØªØ§Ø­:</h4><p>${event.Media[112] ? event.Media[112][0].eventId : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>` : ''}
                        `;
                        
                        const card = document.createElement('div');
                        card.className = 'match-card';
                        card.innerHTML = `
                            <div class="match-info">
                                <span class="league-name" data-type="detail" data-title="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±ÙŠ" data-content="${leagueDetails}">${leagueName}</span>
                                
                                <span class="team-name" data-type="detail" data-title="${homeTeam.Nm} vs ${awayTeam.Nm}" data-content="${matchDetailsForModal}">${homeTeam.Nm} (${homeTeam.Abr})</span>
                                
                                <span class="time-status">${statusText === 'Ù„Ù… ØªØ¨Ø¯Ø£' ? startTime.split(' ')[1] : statusText}</span>
                                
                                <span class="team-name" data-type="detail" data-title="${homeTeam.Nm} vs ${awayTeam.Nm}" data-content="${matchDetailsForModal}">${awayTeam.Nm} (${awayTeam.Abr})</span>
                            </div>
                        `;
                        matchesList.appendChild(card);
                    });
                } else {
                     matchesList.innerHTML += `<p style="padding: 10px; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ù…ÙØ¬Ø¯ÙˆÙ„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙˆØ±ÙŠ.</p>`;
                }
            });

            addInteractionListeners();
        }

        /**
         * 3. Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
         */

        function getStatusText(eps) {
            switch (eps) {
                case 'NS': return 'Ù„Ù… ØªØ¨Ø¯Ø£';
                case 'FT': return 'Ù…ÙƒØªÙ…Ù„Ø©';
                case 'HT': return 'Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´ÙˆØ· Ø§Ù„Ø£ÙˆÙ„';
                case '1T': return 'Ø§Ù„Ø´ÙˆØ· Ø§Ù„Ø£ÙˆÙ„';
                case '2T': return 'Ø§Ù„Ø´ÙˆØ· Ø§Ù„Ø«Ø§Ù†ÙŠ';
                case 'PEN': return 'Ø±ÙƒÙ„Ø§Øª ØªØ±Ø¬ÙŠØ­';
                default: return eps;
            }
        }

        function formatTime(esd) {
            if (!esd || esd.length !== 14) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const year = esd.substring(0, 4);
            const month = esd.substring(4, 6);
            const day = esd.substring(6, 8);
            const hour = esd.substring(8, 10);
            const minute = esd.substring(10, 12);
            return `${day}/${month}/${year} ${hour}:${minute}`;
        }


        /**
         * 4. Ø¯Ø§Ù„Ø© ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Modal) Ø§Ù„Ø¹Ø§Ù…Ø©
         */
        function openModal(title, content) {
            modalContentPlaceholder.innerHTML = content;
            // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù„Ù€ h3 Ø¯Ø§Ø®Ù„ content Ù†ÙØ³Ù‡
            matchModal.style.display = "block";
        }


        /**
         * 5. Ø¯Ø§Ù„Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© ØªÙØ§Ø¹Ù„ Ø§Ù„Ù†Ù‚Ø±
         */
        function addInteractionListeners() {
            document.querySelectorAll('[data-type="detail"]').forEach(element => {
                element.addEventListener('click', (event) => {
                    event.stopPropagation();
                    
                    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Data Attributes Ù„ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ù…Ø¨Ø§Ø´Ø±Ø©
                    const title = event.target.dataset.title;
                    const content = event.target.dataset.content;

                    openModal(title, content);
                });
            });

            closeModalButton.addEventListener('click', () => matchModal.style.display = "none");
            window.addEventListener('click', (event) => {
                if (event.target === matchModal) {
                    matchModal.style.display = "none";
                }
            });
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        renderMatches();
    </script>
</body>
</html>
