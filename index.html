<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¹Ø±Ø¶ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª - ØªØ·Ø¨ÙŠÙ‚ Ù…ØªÙƒØ§Ù…Ù„</title>
    <style>
        /* --- CSS Styling: ØªØµÙ…ÙŠÙ… Ø¹ØµØ±ÙŠ ÙˆÙ…Ø­Ø³Ù† --- */
        body {
            font-family: 'Droid Arabic Kufi', 'Arial', sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;
            padding: 20px;
            text-align: right; 
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: #fff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }
        h2 {
            color: #17a2b8;
            border-bottom: 3px solid #17a2b8;
            padding-bottom: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        .league-title-header { 
            background-color: #e9f7fe;
            color: #17a2b8;
            padding: 12px 15px;
            margin-top: 25px;
            margin-bottom: 15px;
            border-radius: 8px;
            font-size: 1.4em;
            font-weight: 700;
        }
        .match-card {
            background-color: #ffffff;
            border-radius: 10px;
            margin-bottom: 10px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
            border-right: 4px solid #28a745;
        }
        .match-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .match-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .clickable-item {
            font-weight: 600;
            color: #007bff;
            cursor: pointer;
            text-decoration: none;
            flex-grow: 1;
            padding: 0 10px;
            text-align: center;
            transition: color 0.2s;
        }
        .clickable-item:hover {
            color: #0056b3;
            text-decoration: underline;
        }
        .league-name {
             flex-basis: 30%;
             color: #28a745;
        }
        .time-status {
            font-weight: bold;
            color: #dc3545;
            margin: 0 15px;
            flex-basis: 10%;
            text-align: center;
        }

        /* --- Modal & Table Styling --- */
        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto;
            background-color: rgba(0, 0, 0, 0.8); 
            padding-top: 50px;
        }
        .modal-content {
            background-color: #fefefe; margin: 5% auto; padding: 30px;
            border-radius: 15px; width: 90%; max-width: 900px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
        }
        .close { float: left; font-size: 35px; font-weight: bold; cursor: pointer; color: #aaa; }
        .modal-title { color: #17a2b8; text-align: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #ddd; }
        
        .modal-body table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9em;
        }
        .modal-body th, .modal-body td {
            padding: 10px 8px;
            border: 1px solid #eee;
            text-align: center;
        }
        .modal-body th {
            background-color: #f0f0f0;
            color: #333;
        }
        .event-item {
            border-bottom: 1px dashed #eee;
            padding: 8px 0;
        }
        .loader {
            border: 4px solid #f3f3f3; border-top: 4px solid #17a2b8;
            border-radius: 50%; width: 30px; height: 30px;
            animation: spin 1s linear infinite; margin: 20px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="container">
        <h2 id="main-title">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª: 2025/12/01</h2>
        <div id="matches-list">
            <p id="loading-message">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
        </div>
    </div>

    <div id="match-modal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-modal">&times;</span>
            <h3 class="modal-title" id="modal-title"></h3>
            <div id="modal-content-placeholder" class="modal-body">
                </div>
        </div>
    </div>

    <script>
        // --- JavaScript Logic ---

        // ğŸš© Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„ÙˆÙƒÙŠÙ„ (ÙŠØ¬Ø¨ Ø£Ù† ØªØ¹Ù…Ù„ ÙˆØªÙƒÙˆÙ† Ù…Ù‡ÙŠØ¦Ø© ÙÙŠ Netlify Functions)
        const PROXY_MATCHES_URL = 'https://mubarayat.netlify.app/.netlify/functions/fetch-matches'; 
        const PROXY_STANDINGS_URL = 'https://mubarayat.netlify.app/.netlify/functions/fetch-standings'; 
        const PROXY_DETAILS_URL = 'https://mubarayat.netlify.app/.netlify/functions/fetch-details'; 
        
        const matchesList = document.getElementById('matches-list');
        const matchModal = document.getElementById('match-modal');
        const modalContentPlaceholder = document.getElementById('modal-content-placeholder');
        const modalTitle = document.getElementById('modal-title');
        const closeModalButton = document.getElementById('close-modal');
        const loadingMessage = document.getElementById('loading-message');

        /**
         * Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ±ØªÙŠØ¨ Ù„Ù„Ø¯ÙˆØ±ÙŠ ÙˆØ¹Ø±Ø¶Ù‡Ø§
         * ØªÙØªØ±Ø¶ Ø£Ù† Proxy Function ØªØ³ØªÙ‚Ø¨Ù„ `sid` ÙˆØªÙØ¹ÙŠØ¯ Ù‡ÙŠÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Standings.
         */
        async function fetchStandings(sid, leagueName) {
            try {
                openModal(`Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ØªØ±ØªÙŠØ¨ ${leagueName}...`, '<div class="loader"></div>');
                // 1. Ø§Ù„Ø¬Ù„Ø¨ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„ÙˆÙƒÙŠÙ„
                const response = await fetch(`${PROXY_STANDINGS_URL}?sid=${sid}`);
                if (!response.ok) throw new Error(`Status: ${response.status}`);
                const data = await response.json();
                
                // 2. Ø¨Ù†Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ±ØªÙŠØ¨ (Standings Table)
                let html = '<h4>ğŸ¥‡ Ø¬Ø¯ÙˆÙ„ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¯ÙˆØ±ÙŠ:</h4>';
                
                if (data.Tables && data.Tables.length > 0 && data.Tables[0].Rows) {
                    html += `<table class="standings-table">
                        <thead><tr>
                            <th>#</th><th>Ø§Ù„ÙØ±ÙŠÙ‚</th><th>Ù„Ø¹Ø¨</th><th>Ù</th><th>Øª</th><th>Ø®</th><th>Ø£.Ù„Ù‡</th><th>Ø£.Ø¹Ù„ÙŠÙ‡</th><th>ÙØ§Ø±Ù‚</th><th>Ù†Ù‚Ø§Ø·</th>
                        </tr></thead><tbody>`;
                    
                    data.Tables[0].Rows.forEach(row => {
                        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙØ§ØªÙŠØ­ API Ù†Ù…ÙˆØ°Ø¬ÙŠØ© Ù„Ù„ØªØ±ØªÙŠØ¨ (Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù€ API Ø§Ù„ÙØ¹Ù„ÙŠ)
                        html += `<tr>
                            <td>${row.Rn || ''}</td>
                            <td style="text-align: right;">${row.Tnm || ''}</td>
                            <td>${row.P || 0}</td>
                            <td>${row.W || 0}</td>
                            <td>${row.D || 0}</td>
                            <td>${row.L || 0}</td>
                            <td>${row.GD || 0}</td>
                            <td>${row.GA || 0}</td>
                            <td>${row.G || 0}</td>
                            <td><strong>${row.Pts || 0}</strong></td>
                        </tr>`;
                    });
                    html += '</tbody></table>';
                } else {
                    html += `<p style="color: #888;">Ù„Ø§ ØªØªÙˆÙØ± Ø¨ÙŠØ§Ù†Ø§Øª ØªØ±ØªÙŠØ¨ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø­Ø§Ù„ÙŠØ§Ù‹.</p>`;
                }

                // 3. Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
                openModal(`ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¯ÙˆØ±ÙŠ: ${leagueName}`, html);
                
            } catch (error) {
                openModal('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„', `<p style="color: red;">ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ±ØªÙŠØ¨. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯ Netlify Function (fetch-standings) Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­: ${error.message}</p>`);
            }
        }


        /**
         * Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© ÙˆØ¹Ø±Ø¶Ù‡Ø§
         * ØªÙØªØ±Ø¶ Ø£Ù† Proxy Function ØªØ³ØªÙ‚Ø¨Ù„ `eid` ÙˆØªÙØ¹ÙŠØ¯ Ù‡ÙŠÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© (H2H, Events).
         */
        async function fetchMatchDetails(eid, home, away) {
            try {
                openModal(`Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ ${home} vs ${away}...`, '<div class="loader"></div>');
                const response = await fetch(`${PROXY_DETAILS_URL}?eid=${eid}`);
                if (!response.ok) throw new Error(`Status: ${response.status}`);
                const data = await response.json();
                
                let html = `<h4>âš½ï¸ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©: ${home} vs ${away}</h4><hr>`;
                
                // 1. Ù‚Ø³Ù… Ø§Ù„Ø£Ø­Ø¯Ø§Ø« (Goals, Cards, Substitutions)
                html += '<h5>âš¡ï¸ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© (Ø§Ù„Ø£Ù‡Ø¯Ø§ÙØŒ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª):</h5>';
                if (data.Events && data.Events.length > 0) {
                    data.Events.forEach(e => {
                        // Ø§ÙØªØ±Ø§Ø¶ Ø£Ù† e.Min Ù‡Ùˆ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©ØŒ e.Nm Ù‡Ùˆ Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¯Ø«ØŒ e.Tnm Ù‡Ùˆ Ø§Ù„ÙØ±ÙŠÙ‚
                        html += `<div class="event-item"><strong>(${e.Min}')</strong>: ${e.Nm} - ${e.Tnm}</div>`;
                    });
                } else {
                    html += '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø­Ø¯Ø§Ø« Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯.</p>';
                }

                // 2. Ù‚Ø³Ù… Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© (H2H)
                html += '<h5>âš”ï¸ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© (Head-to-Head):</h5>';
                if (data.H2H && data.H2H.length > 0) {
                    data.H2H.forEach(match => {
                        // Ø§ÙØªØ±Ø§Ø¶ Ø£Ù† H2H ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø³Ø§Ø¨Ù‚Ø©
                        html += `<div class="event-item">
                            ${formatTime(match.Esd).split(' ')[0]} | 
                            ${match.T1nm} <span style="font-weight: bold;">${match.Tr1} - ${match.Tr2}</span> ${match.T2nm}
                        </div>`;
                    });
                } else {
                    html += '<p>Ù„Ø§ ØªØªÙˆÙØ± Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©.</p>';
                }
                
                // 3. Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
                openModal(`ØªÙØ§ØµÙŠÙ„: ${home} vs ${away}`, html);
                
            } catch (error) {
                openModal('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„', `<p style="color: red;">ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯ Netlify Function (fetch-details) Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­: ${error.message}</p>`);
            }
        }

        // ----------------------------------------------------------------------
        // Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Matches Fetching and Rendering)

        async function fetchMatchesData() {
            try {
                const response = await fetch(PROXY_MATCHES_URL);
                if (!response.ok) throw new Error(`Status: ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error("Fetch Matches Error:", error);
                return null;
            }
        }
        
        async function renderMatches() {
            const data = await fetchMatchesData();

            if (loadingMessage) loadingMessage.remove(); 
            
            if (!data || !data.Stages) {
                matchesList.innerHTML = `<p style="color: red; padding: 10px;">ğŸ”´ **ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.** ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„ÙˆÙƒÙŠÙ„: <code>${PROXY_MATCHES_URL}</code></p>`;
                return;
            }

            matchesList.innerHTML = ''; 

            data.Stages.forEach(stage => {
                const leagueName = stage.Snm;
                const countryName = stage.Cnm;
                
                // Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯ÙˆØ±ÙŠ (Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù†Ù‚Ø±)
                const leagueHeader = document.createElement('h3');
                leagueHeader.className = 'league-title-header clickable-item'; 
                leagueHeader.innerHTML = `ğŸ† ${leagueName} - ${countryName}`;
                leagueHeader.dataset.sid = stage.Sid;
                leagueHeader.dataset.action = 'standings';
                leagueHeader.dataset.leaguename = leagueName; // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø§Ø³Ù… Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ ÙÙŠ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†

                matchesList.appendChild(leagueHeader);

                // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¯ÙˆØ±ÙŠ
                if (stage.Events && stage.Events.length > 0) {
                    stage.Events.forEach(event => {
                        const homeTeam = event.T1[0];
                        const awayTeam = event.T2[0];
                        
                        const statusText = getStatusText(event.Eps);
                        const startTime = formatTime(event.Esd); 
                        
                        const matchTime = startTime.split(' ')[1]; 
                        const statusDisplay = statusText === 'Ù„Ù… ØªØ¨Ø¯Ø£' ? matchTime : statusText; 
                        
                        const card = document.createElement('div');
                        card.className = 'match-card';
                        
                        // Ø¬Ù…ÙŠØ¹ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù†Ù‚Ø± Ù„Ø¬Ù„Ø¨ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©
                        const matchInfoHTML = `
                            <span class="league-name clickable-item" data-action="standings" data-sid="${stage.Sid}" data-leaguename="${leagueName}">
                                ${leagueName}
                            </span>
                            
                            <span class="clickable-item" data-action="details" data-eid="${event.Eid}" data-home="${homeTeam.Nm}" data-away="${awayTeam.Nm}">
                                ${homeTeam.Nm} (${homeTeam.Abr})
                            </span>
                            
                            <span class="time-status">${statusDisplay}</span>
                            
                            <span class="clickable-item" data-action="details" data-eid="${event.Eid}" data-home="${homeTeam.Nm}" data-away="${awayTeam.Nm}">
                                ${awayTeam.Nm} (${awayTeam.Abr})
                            </span>
                        `;
                        
                        card.innerHTML = `<div class="match-info">${matchInfoHTML}</div>`;
                        matchesList.appendChild(card);
                    });
                }
            });

            addInteractionListeners();
        }

        // ----------------------------------------------------------------------
        // Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙˆØ§Ù„ØªÙ†Ø³ÙŠÙ‚
        
        function getStatusText(eps) {
            switch (eps) {
                case 'NS': return 'ÙˆÙ‚Øª Ù„Ø§Ø­Ù‚';
                case 'FT': return 'Ù…ÙƒØªÙ…Ù„Ø©';
                case 'HT': return 'Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´ÙˆØ· 1';
                case '1T': return 'Ø§Ù„Ø´ÙˆØ· Ø§Ù„Ø£ÙˆÙ„';
                case '2T': return 'Ø§Ù„Ø´ÙˆØ· Ø§Ù„Ø«Ø§Ù†ÙŠ';
                case 'PEN': return 'Ø±ÙƒÙ„Ø§Øª ØªØ±Ø¬ÙŠØ­';
                default: return eps;
            }
        }

        function formatTime(esd) {
            if (!esd || esd.length !== 14) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            const year = esd.substring(0, 4);
            const month = esd.substring(4, 6);
            const day = esd.substring(6, 8);
            const hour = esd.substring(8, 10);
            const minute = esd.substring(10, 12);
            return `${day}/${month}/${year} ${hour}:${minute}`;
        }


        /**
         * Ø¯Ø§Ù„Ø© ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Modal) Ø§Ù„Ø¹Ø§Ù…Ø©
         */
        function openModal(title, content) {
            modalTitle.textContent = title;
            modalContentPlaceholder.innerHTML = content;
            matchModal.style.display = "block";
        }


        /**
         * Ø¯Ø§Ù„Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© ØªÙØ§Ø¹Ù„ Ø§Ù„Ù†Ù‚Ø±
         */
        function addInteractionListeners() {
            document.querySelectorAll('[data-action]').forEach(element => {
                element.addEventListener('click', (event) => {
                    const action = event.currentTarget.dataset.action;
                    
                    if (action === 'standings') {
                        const sid = event.currentTarget.dataset.sid;
                        const leagueName = event.currentTarget.dataset.leaguename;
                        fetchStandings(sid, leagueName);
                    } 
                    
                    else if (action === 'details') {
                        const eid = event.currentTarget.dataset.eid;
                        const home = event.currentTarget.dataset.home;
                        const away = event.currentTarget.dataset.away;
                        fetchMatchDetails(eid, home, away);
                    }
                });
            });

            closeModalButton.addEventListener('click', () => matchModal.style.display = "none");
            window.addEventListener('click', (event) => {
                if (event.target === matchModal) {
                    matchModal.style.display = "none";
                }
            });
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        renderMatches();
    </script>
</body>
</html>
